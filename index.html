<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Расстояние до точки</title>
  <style>
    body { font-family: sans-serif; padding: 2em; }
    #distance { font-size: 1.5em; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Расстояние до заданной точки</h1>
  <button onclick="updateDistance()">Обновить расстояние</button>
  <div id="distance">Ожидаем данные...</div>

  <script>
    const encodedLat = "1l91";
    const encodedLng = "2dse";

    function decodeCoordinate(base36str) {
      return parseInt(base36str, 36) / 100000; // радианы
    }

    function haversineDistance(lat1, lon1, lat2, lon2) {
      const R = 6371000; // радиус Земли в метрах
      const dLat = lat2 - lat1;
      const dLon = lon2 - lon1;
      const a = Math.sin(dLat/2)**2 +
                Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function toRadians(deg) {
      return deg * Math.PI / 180;
    }

    function updateDistance() {
      if (!navigator.geolocation) {
        document.getElementById('distance').textContent = 'Геолокация не поддерживается.';
        return;
      }

      navigator.geolocation.getCurrentPosition(position => {
        const lat1 = toRadians(position.coords.latitude);
        const lon1 = toRadians(position.coords.longitude);

        const lat2 = decodeCoordinate(encodedLat);
        const lon2 = decodeCoordinate(encodedLng);

        const distance = haversineDistance(lat1, lon1, lat2, lon2);
        document.getElementById('distance').textContent =
          `Расстояние: ${Math.round(distance)} метров`;
      }, error => {
        document.getElementById('distance').textContent = 'Ошибка получения геопозиции.';
      });
    }

    // Автообновление при изменении позиции
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(() => updateDistance());
    }

    updateDistance(); // при загрузке
  </script>
</body>
</html>
